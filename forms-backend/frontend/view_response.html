<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pogledaj odgovor</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { margin-bottom: 10px; }
    .question { margin-bottom: 15px; padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
    .question h3 { margin: 0 0 5px 0; }
    .answer { font-weight: bold; color: #333; }
  </style>
</head>
<body>
  <h1 id="formTitle">Forma</h1>
  <p id="submittedAt"></p>
  <div id="questions"></div>
  <button onclick="goBack()">Nazad</button>

  <script>
    const token = localStorage.getItem('token');
    const params = new URLSearchParams(window.location.search);
    const responseId = params.get('id');

    async function fetchResponse() {
      const res = await fetch(`http://localhost:3002/response/${responseId}`, {
        headers: { 'Authorization': 'Bearer ' + token }
      });
      const data = await res.json();
      renderResponse(data);
    }

    function renderResponse(data) {
      document.getElementById('formTitle').textContent = data.response.form_title;
      document.getElementById('submittedAt').textContent = 'Poslato: ' + new Date(data.response.submitted_at).toLocaleString();

      const container = document.getElementById('questions');
      container.innerHTML = '';

      data.questions.forEach(q => {
        const div = document.createElement('div');
        div.className = 'question';
        let answerText = '';

        if (q.type === 'single_choice') {
          const selected = q.options.find(o => o.id == q.answer);
          answerText = selected ? selected.text : '-';
        } else if (q.type === 'multiple_choice') {
          const selected = q.options.filter(o => q.answer.includes(o.id)).map(o => o.text);
          answerText = selected.length ? selected.join(', ') : '-';
        } else {
          answerText = q.answer || '-';
        }

        div.innerHTML = `<h3>${q.text}</h3><p class="answer">${answerText}</p>`;
        container.appendChild(div);
      });
    }

    function goBack() {
      window.history.back();
    }

    fetchResponse();
  </script>
</body>
</html>